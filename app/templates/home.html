<!DOCTYPE html>
<html lang="en">
<head>
    <title>Payroll Dashboard</title>
    {% include 'head.html' %}
    {% include 'navbar.html' %}
</head>

<body class="bg-light">

<div class="container mt-2">

    <!-- Dashboard Header -->
    <h3 class="mb-4 text-primary fw-bold text-center">Payroll Dashboard</h3>

    <!-- Filters -->
    <div class="card shadow-sm border-0 mb-4 p-3">
        <div class="row g-2 align-items-end">
            <div class="col-md-3">
                <label class="form-label">Select Period</label>
                <select class="form-select">
                    <option>Weekly</option>
                    <option selected>Monthly</option>
                    <option>Quarterly</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Unit</label>
                <select class="form-select">
                    <option selected>All Units</option>
                    <option>Carnivore</option>
                    <option>Tamarind Tree</option>
                    <option>RBC</option>
                    <option>KLG</option>
                    <option>MSA</option>
                    <option>TVL</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Date Range</label>
                <input type="date" class="form-control">
            </div>
            <div class="col-md-3 text-end">
                <button class="btn btn-primary w-100">Filter</button>
            </div>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row g-3">
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h6>Total Base Amount</h6>
                <h4 class="text-success fw-bold">Ksh 1,099,166.37</h4>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h6>Total Deductions</h6>
                <h4 class="text-danger fw-bold">Ksh 241,516.37</h4>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h6>Total Credits</h6>
                <h4 class="text-info fw-bold">Ksh 857,650.00</h4>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h6>Net Payment</h6>
                <h4 class="text-primary fw-bold">Ksh 616,133.63</h4>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="row mt-4">
        <!-- Deductions Breakdown -->
        <div class="col-md-5">
            <div class="card shadow-sm border-0 p-3 h-100">
                <h6 class="mb-3 fw-bold">Deductions Breakdown</h6>
                <canvas id="deductionsChart" height="300"></canvas>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 p-3 h-100">
                <h6 class="fw-bold mb-3 text-center">Quick Statistics</h6>
                <ul class="list-group list-group-flush small">
                    <li class="list-group-item d-flex justify-content-between"><span>NSSF</span><span>80,400.12</span></li>
                    <li class="list-group-item d-flex justify-content-between"><span>PAYE</span><span>0.00</span></li>
                    <li class="list-group-item d-flex justify-content-between"><span>SHIF</span><span>105,900.00</span></li>
                    <li class="list-group-item d-flex justify-content-between"><span>Housing Levy</span><span>19,664.25</span></li>
                    <li class="list-group-item d-flex justify-content-between"><span>Advances</span><span>6,500.00</span></li>
                    <li class="list-group-item d-flex justify-content-between"><span>Pending Bills</span><span>0.00</span></li>
                    <li class="list-group-item d-flex justify-content-between"><span>Tips</span><span>29,052.00</span></li>
                </ul>
            </div>
        </div>

        <!-- Payments by Unit -->
        <div class="col-md-4">
            <div class="card shadow-sm border-0 p-3 h-100">
                <h6 class="fw-bold mb-3 text-center">Payments by Unit</h6>
                <canvas id="unitPaymentsChart" height="220"></canvas>
            </div>
        </div>
    </div>

    <!-- Monthly Payment Trend -->
    <div class="card shadow-sm border-0 mt-4 p-3">
        <h6 class="mb-3 fw-bold">Monthly Payment Trend</h6>
        <canvas id="trendChart" height="120"></canvas>
    </div>

    <!-- Highlights -->
    <div class="card shadow-sm border-0 mt-4 p-3">
        <h6 class="fw-bold mb-3 text-primary">Highlights</h6>
        <ul class="list-group list-group-flush">
            <li class="list-group-item text-success"><b>‚úÖ PAYE</b> remained consistent with no arrears this period.</li>
            <li class="list-group-item text-danger"><b>‚ö†Ô∏è SHIF</b> contributions rose by 12% compared to last month.</li>
            <li class="list-group-item text-warning"><b>üìà Housing Levy</b> continues a steady upward trend (8% increase).</li>
            <li class="list-group-item text-info"><b>üí° Carnivore</b> recorded the highest payroll among all units.</li>
            <li class="list-group-item text-secondary"><b>üìä Net payments</b> grew by 5% vs previous month.</li>
        </ul>
    </div>

</div>

<script>
Chart.register(ChartDataLabels);

// ===== DEDUCTIONS CHART =====
new Chart(document.getElementById('deductionsChart'), {
    type: 'bar',
    data: {
        labels: ['NSSF', 'PAYE', 'SHIF', 'Housing Levy', 'Advances', 'Pending Bills', 'Tips'],
        datasets: [{
            data: [80400.12, 0, 105900, 19664.25, 6500, 0, 29052],
            backgroundColor: ['#4e79a7','#f28e2b','#e15759','#76b7b2','#59a14f','#edc948','#b07aa1'],
            borderRadius: 6
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {display: false},
            datalabels: {
                anchor: 'end',
                align: 'top',
                formatter: v => (v / 1000).toFixed(1) + 'K',
                color: '#333',
                font: {weight: 'bold'}
            }
        },
        scales: { y: {beginAtZero: true, ticks: {stepSize: 20000}} }
    }
});

// ===== PAYMENTS BY UNIT (PIE CHART) =====
new Chart(document.getElementById('unitPaymentsChart'), {
    type: 'pie',
    data: {
        labels: ['Carnivore', 'Tamarind Tree', 'RBC', 'KLG', 'MSA', 'TVL'],
        datasets: [{
            data: [250000, 180000, 150000, 120000, 90000, 70000],
            backgroundColor: ['#4e79a7','#f28e2b','#e15759','#76b7b2','#59a14f','#edc948']
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {display: false},
            datalabels: {
                color: '#fff',
                formatter: (value, ctx) => {
                    const total = ctx.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                    const kValue = (value / 1000).toFixed(1);
                    const label = ctx.chart.data.labels[ctx.dataIndex];
                    return `${label}\n${kValue}K`;
                },
                font: {weight: 'bold', size: 11}
            }
        }
    },
    plugins: [ChartDataLabels]
});

// ===== MONTHLY PAYMENT TREND =====
new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
        datasets: [{
            label: 'Total Paid',
            data: [850000, 870000, 890000, 910000, 940000, 970000, 995000, 1010000, 1040000, 1099166],
            fill: true,
            backgroundColor: 'rgba(78,121,167,0.15)',
            borderColor: '#4e79a7',
            tension: 0.3,
            pointRadius: 3,
            pointBackgroundColor: '#4e79a7'
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {display: false},
            datalabels: {
                align: 'top',
                anchor: 'end',
                formatter: v => (v / 1000).toFixed(1) + 'K',
                color: '#333',
                font: {weight: 'bold'}
            }
        },
        scales: { y: {beginAtZero: false} }
    }
});
</script>

</body>
</html>
