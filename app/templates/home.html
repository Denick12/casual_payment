<!DOCTYPE html>
<html lang="en">
<head>
    <title>Payroll Dashboard</title>
    {% include 'head.html' %}
    {% include 'navbar.html' %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
</head>

<body class="bg-light">

<div class="container mt-2">

    <!-- Dashboard Header -->
    <h3 class="mb-4 text-primary fw-bold text-center">Payroll Dashboard</h3>

    <!-- Summary Cards -->
    <div class="row g-3">
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h6>Total Base Amount</h6>
                <h4 class="text-success fw-bold">Ksh 1,099,166.37</h4>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h6>Total Deductions</h6>
                <h4 class="text-danger fw-bold">Ksh 241,516.37</h4>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h6>Total Credits</h6>
                <h4 class="text-info fw-bold">Ksh 857,650.00</h4>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center p-3">
                <h6>Net Payment</h6>
                <h4 class="text-primary fw-bold">Ksh 616,133.63</h4>
            </div>
        </div>
    </div>

    <!-- Charts Section (Deductions + Quick Stats + Pie Chart) -->
    <div class="row mt-4">
        <!-- Deductions Breakdown -->
        <div class="col-md-5">
            <div class="card shadow-sm border-0 p-3 h-100">
                <h6 class="mb-3 fw-bold">Deductions Breakdown</h6>
                <canvas id="deductionsChart" height="300"></canvas>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 p-3 h-100">
                <h6 class="fw-bold mb-3 text-center">Quick Statistics</h6>
                <ul class="list-group list-group-flush small">
                    <li class="list-group-item d-flex justify-content-between"><span>NSSF</span><span>80,400.12</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between"><span>PAYE</span><span>0.00</span></li>
                    <li class="list-group-item d-flex justify-content-between"><span>SHIF</span><span>105,900.00</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Housing Levy</span><span>19,664.25</span></li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Advances</span><span>6,500.00</span></li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Pending Bills</span><span>0.00</span></li>
                    <li class="list-group-item d-flex justify-content-between"><span>Tips</span><span>29,052.00</span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Compact Payments by Unit (Pie Chart) -->
        <div class="col-md-4">
            <div class="card shadow-sm border-0 p-3 h-100">
                <h6 class="fw-bold mb-3 text-center">Payments by Unit (%)</h6>
                <canvas id="unitPaymentsChart" height="180"></canvas>
            </div>
        </div>
    </div>

    <!-- Monthly Trend -->
    <div class="card shadow-sm border-0 mt-4 p-3">
        <h6 class="mb-3 fw-bold">Monthly Payment Trend</h6>
        <canvas id="trendChart" height="120"></canvas>
    </div>

</div>

<script>
    Chart.register(ChartDataLabels);

    // ===== DEDUCTIONS CHART =====
    const deductionsCtx = document.getElementById('deductionsChart');
    new Chart(deductionsCtx, {
        type: 'bar',
        data: {
            labels: ['NSSF', 'PAYE', 'SHIF', 'Housing Levy', 'Advances', 'Pending Bills', 'Tips'],
            datasets: [{
                label: 'Amount',
                data: [80400.12, 0, 105900, 19664.25, 6500, 0, 29052],
                backgroundColor: ['#4e79a7', '#f28e2b', '#e15759', '#76b7b2', '#59a14f', '#edc948', '#b07aa1'],
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {display: false},
                title: {
                    display: true,
                    {#text: 'Statutory and Other Deductions',#}
                    font: {size: 14}
                },
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    formatter: v => (v / 1000).toFixed(1) + 'K',
                    color: '#333',
                    font: {weight: 'bold'}
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {stepSize: 20000}
                }
            }
        }
    });

    // ===== PAYMENTS BY UNIT (SMALL PIE) =====
    const unitCtx = document.getElementById('unitPaymentsChart');
    new Chart(unitCtx, {
        type: 'pie',
        data: {
            labels: ['CNV', 'TTC', 'RTC', 'KLG', 'RBC', 'MSA', 'TVL'],
            datasets: [{
                data: [180000, 220000, 130000, 95000, 145000, 185000, 144166.37],
                backgroundColor: ['#4e79a7', '#f28e2b', '#e15759', '#76b7b2', '#59a14f', '#edc948', '#b07aa1']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {position: 'bottom', labels: {boxWidth: 12}},
                datalabels: {
                    color: '#fff',
                    formatter: v => (v / 1000).toFixed(1) + 'K',
                    font: {weight: 'bold', size: 10}
                }
            },
            layout: {padding: 10}
        }
    });

    // ===== TREND CHART (LINE) =====
    const trendCtx = document.getElementById('trendChart');
    new Chart(trendCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
            datasets: [{
                label: 'Total Paid',
                data: [850000, 870000, 890000, 910000, 940000, 970000, 995000, 1010000, 1040000, 1099166],
                fill: true,
                backgroundColor: 'rgba(78,121,167,0.15)',
                borderColor: '#4e79a7',
                tension: 0.3,
                pointRadius: 3,
                pointBackgroundColor: '#4e79a7'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {display: false},
                datalabels: {
                    align: 'top',
                    anchor: 'end',
                    formatter: v => (v / 1000).toFixed(1) + 'K',
                    color: '#333',
                    font: {weight: 'bold'}
                }
            },
            scales: {
                y: {beginAtZero: false}
            }
        }
    });
</script>

</body>
</html>
